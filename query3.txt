
                              <p>Query17: GROUPBY REPORT AIRCRAFT PURCHASE RATE</p>
           
                              <form method="POST" action="database_init2.php">  
                              <p><select name='decide'>
                              <option value='avg1'>AVG PURCHASE RATE</option>
                              <option value='max1'>MAX PURCHASE RATE</option>
                              <option value='min1'>MIN PURCHASE RATE</option>
                              <input type="submit" value="search" name="query17"></p>
                              </form>

     <p>Query11: TICKET PURCHASE</p>
                    <P>   flightnumber ddate fullname passportnumber nationality gender email</P>
                    <form method="POST" action="database_init2.php">  
                      <p>
                       <input type="text" name="flightno1">
                      <input type="text" name="ddate11">
                        <input type="text" name="fname1">
                         <input type="text" name="passptno1">
                          <input type="text" name="nationality1">
                           <input type="text" name="gender1">
                            <input type="text" name="email1">
                        <p>are you member?</p>
                        <select name='member'>
                        <option value='yes'> Y</option>
                        <option value='no'> N</option>
                          <input type="text" name="userid11">
                           <input type="text" name="password11">
                        <input type="submit" value="search" name="query11"></p>
                      </form>


function printresultidprice($result) { //prints results from a select statement
  echo "<table>";
  echo "<tr><th>TicketID</th><th>TicketPrice</th></tr>";

  while ($row = OCI_Fetch_Array($result, OCI_BOTH)) {
    echo "<tr><td>" . $row[0] . "</td><td>" . $row[1] ."</td></tr>" ;
}
echo "</table>";    
}

 if(array_key_exists('query17', $_POST)){
               $result1= executePlainSQL("
               select round(AVG(avgs)*100,4)
               from(select AVG(Flight_Use.numOfPassengers/AirCraft.capacity) as avgs
                from AirCraft,Flight_Use
                where Flight_Use.aircraftSerialNo=AirCraft.serialNo
                group by AirCraft.serialNo)
                ");
       
           $result2= executePlainSQL("
                select round(MAX(avgs)*100,4)
                from(select AVG(Flight_Use.numOfPassengers/AirCraft.capacity) as avgs
                from AirCraft,Flight_Use
                where Flight_Use.aircraftSerialNo=AirCraft.serialNo
                group by AirCraft.serialNo)
                ");

           $result3= executePlainSQL("
               select round(MIN(avgs)*100,4)
              from(select AVG(Flight_Use.numOfPassengers/AirCraft.capacity) as avgs
                from AirCraft,Flight_Use
                where Flight_Use.aircraftSerialNo=AirCraft.serialNo
                group by AirCraft.serialNo)
                ");
                
   if(isset($_POST['decide'])){
    $decide = $_POST['decide'];
    switch ($decide) {
        case 'avg1':
           echo 'AVG PURCHASE RATE: ',OCI_Fetch_Array($result1,OCI_BOTH)[0],'%';
            break;
        case 'max1':
            echo 'MAX PURCHASE RATE: ',OCI_Fetch_Array($result2,OCI_BOTH)[0],'%';
            break;
        case 'min1':
              echo 'MIN PURCHASE RATE: ',OCI_Fetch_Array($result3,OCI_BOTH)[0],'%';
            break;
    }
}   
              } 



if(array_key_exists('query11', $_POST)){
                
                $flightno=$_POST['flightno1'];
                $date=$_POST['ddate11'];
                $passportnumber=$_POST['passptno1']; 
                $ticketid=mt_rand(1000000000000,9999999999999);           
                $temp=executePlainSQL("select ticketPrice from Flight_Use where flightNumber='$flightno'and departureDate='$date'");
                  $temp2 = OCI_Fetch_Array($temp, OCI_BOTH);
                 $price = $temp2[0];
               
              executePlainSQL("insert into ticket_has values ('$ticketid','$price','$passportnumber','$flightno','$date')"); 
             if(isset($_POST['member'])){
    $member = $_POST['member'];
    switch ($member) {
        case 'yes':
             echo "yes!";
             $userid=$_POST['userid11'];
             $password=$_POST['password11'];
           if(executePlainSQL("
            select case when count(*) > 0 then 1 else 0 end 
            from member_serve
            where userid='$userid' and password='$password'")==0)
                {echo"wrong password!";}
                 else
            {executePlainSQL("insert into purchase values ('$userid','$ticketid')");
                OCICommit($db_conn);
             $result1=executePlainSQL("select ticketid from purchase where userid='$userid'");
             echo OCI_Fetch_Array($result1,OCI_BOTH)[0];
             $result =  executePlainSQL("select ticket_has.ticketID, ticket_has.ticketPrice from ticket_has where ticket_has.passportNumber = '$passportnumber' and ticket_has.flightNumber =  '$flightno' and ticket_has.dateorg = '$date'");
                printresultidprice($result); 

         }
         
            break;
        case 'no':
        $result =  executePlainSQL("select ticket_has.ticketID, ticket_has.ticketPrice from ticket_has where ticket_has.passportNumber = '$passportnumber' and ticket_has.flightNumber =  '$flightno' and ticket_has.dateorg = '$date'");
                printresultidprice($result); 
            break;
        
    }
}
            
              } 